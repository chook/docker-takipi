language: python

python:
  - "3.7-dev"

services:
  - docker

env:
  global:
    #Production aws key
    - AWS_ACCESS_KEY_ID=AKIA4TXB7QOHH4GTVXZF
    #Production secret key: travis encrypt AWS_SECRET_ACCESS_KEY=<SECRET_KEY>
    - secure: aBpFZ7VNBQtE683M03tMTmoG6K0eIr5GCCZ23sskHaleDGDKZWimqoBMZtNEdZwLTZU5Ul07eVBA4yuem05Wz9YIE079wGLW6jkjiELyGnqgIoYioWzihaabC6P4VFgvdKw+hZhKEiuJtBqCQIgadyqW0dcZ3kJME1EQYBfCAB9fEDD34PIoMilQKQKCtRPJzZFR9lpLd202rbd5dHRZZDyddXE+WEfjBHB1kPLqQuxPHG+iCx0+d0iATAaG3BFIwjA7dQfNGKO5Lhn302J885eSh8UPK2kV4EXEXtniWbWGKi+NLWb6LFbe8UKKTPfF2e/AYxj5NndsZ4kIPhPfRWPech6/OrX5RsdewYCKE8HNv0boE592DhW8PQPWLnzqlQkUpIFS2cpdnm8IeB53/3IP3LbuZ+ZAFx25yLJMrNGRreFImoEHQEfV9RcbSQmNGOZbSzhgMNT9g3tDb8USBhu/33pXMPeyFLwkhJCDnyk3Gbzd18tkBkDx9sM9/OBg51BcwWCY/Og7QIMhkQz7Tc/W3KyRUY27MLaOk9ZWP0d/WBZgC0ey0XgdijZtYZp0Tyh1AjZplygttJT5kpmZltkypihx2+jVeau/W/2njVkxj7oJLXWdnb1FTIMidjXocyK+gtwq76oS5hZr9Xrt54bngmtKBDRIRAINwksiGzk=
    - AWS_DEFAULT_REGION=us-east-1
    # travis encrypt DOCKER_REGISTRY_ID=<registry_id>
    - secure: x6OH3SkTJwVMFbeDaGoJ2FUCiNWL1dwemS/QNCvz8sUdeyxybtHJ5vy853paWtUsx9yADdIx8WnHhM+cUztD9fZlpE9BbRnvrQYk7hw8pcQgmL68pjPsF8tHwZxCuWd8hGw2KdJ4j1jJ3AwMO0+mAddKVc/SeKZEt8ASlQkFGyYRnO4GB01BXWSKMRR8pajxzcBMVXCrXX9zk9cjg6giAmt5OxyshFfAiEtKf4Ht4tjnA29AQ992Qsc+8YWFRHF1AHPCfXmtSQxYKenU4SHLUilZRbnTSqEhfaAiYWK9gDzWbg+I+E8SPyVTtRRGq7d7Vj3oMKLNM8Ap5851JXnPKLMKvaMoU1XnJdFBSrFwFiEUhG/pQZ7MOFwMk/1jpX+QTtlMWY3Kl4bTXr6NYibJXoH09avXGZvpyHmA95Wh83lHtd7AJyR+RjDtXfgHohkki8RRbYXkqxIrAuFVnYr1QQj51pbfryhqrb0ACIZocc14nn1pru6z95MueAGXZ50CMeuANJQTxFrxzlntE2VwK5Geu3G/bmYofQbcOLuOFD9D7pyauIgTbXi5Bbu2gBH+G8GE+DyJBQ70RozlF3oFJN9JoLDrp1x3yns9Q6lRyvOhNp+6f25Lmz52J+qVVjfQBKSE3CItsqAvmfT3dYFzbrdYNPS2c2H8tFpPrfdUhDA=

notifications:
  slack:
    rooms:
      - intentmedia:SrPsBbiyUmm6V0ZMEFIB6RWG
    on_success: never
    on_failure: never
  on:
    branch: master

before_install:
  - pip install awscli

script:

deploy:
  skip_cleanup: true
  provider: script
  script: "./build.sh deploy"
  on:
    branch: master